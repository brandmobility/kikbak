<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link href="css/kikbak.css" rel="stylesheet">
<title>Kikbak</title>
</head>
<body>
<div id="header">
  <div id="back-btn-div" style="display:none;" >
    <a id="back-btn" class="back-btn" href="#">Back</a>
  </div>
  <div id="suggest-btn-div" style="display:none" >
    <a id="suggest-btn" class="suggest-btn" href="#">Suggest</a>
  </div>
  <div id="heading">Kikbak</div>
</div>
<div id="offer-view" class="wrapper" style="dispaly:none;">
  <div class="scroller">
    <ul id="offer-list" class="unstyled list-view">
    </ul>
  </div>
  <div id="no-offer-list" style="display:none;">
    <div class="title">Bummer!</div>
    <div class="detail"><p>There are no Kikbak offers available in your area</p></div>
    <p>Tell us about a business that you'd like to recommend to friends with a special offer</p>
    <a class="suggest-btn btn btn-large btn-success" href="#">Suggest a business</a>
  </div>
</div>
<div id="offer-details-view" class="details" style="display:none;">
</div>
<div id="redeem-view" class="wrapper" style="display:none;">
  <div class="scroller">
    <ul id="redeem-list" class="unstyled list-view">
    </ul>
  </div>
  <div id="no-redeem-list" style="display:none;">
    <div class="title">Doh!</div>
    <div class="detail"><p>You haven't received any gifts or earned any credit</p></div>
    <p>You can change that by giving an offer to your friends. You'll earn credit for every friend that redeems.</p>
    <a class="offer-btn btn btn-large btn-success" href="#">See offers to give to friends</a>
  </div>
</div>
<div id="redeem-details-view" class="details" style="display:none;">
</div>
<div id="suggest-view" style="display:none;">
  <form id="suggest-form" class="form-view" onsubmit="doSuggest(); return false;">
  <div class="add-photo">
    <img src="" class="add-photo show-picture" id="show-picture-suggest" alt="" />
  </div>
  <div class="add-photo-btn">
    <input name="source" type="file" id="take-picture-suggest" class="take-picture" accept="image/*" />
  </div>
  <div id="suggest-form-view">
      <p>Want to recommend a business with 
      a special offer? Tell us and we'll let 
      them know that they should join Kikbak.</p>
      <input name="name" type="text" placeholder="Business name" />
      <input name="reason" type="text" placeholder="What makes them great" />
      <input name="suggest" class="btn" type="submit" value="Let us know" disabled />
  </div>
  </form>
</div>
<div id="footer">
  <div id="footer-div">
    <div id="offer-btn-div">
      <div id="offer-btn" class="footer-btn offer-btn">Give</div>
    </div>
    <div id="redeem-btn-div">
      <div id="redeem-btn" class="footer-btn redeem-btn">Redeem</div>
    </div>
  </div>
</div>
<div id="fb-root"></div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="js/kikbak.js"></script>
<script type="text/javascript" src="js/iscroll.js"></script>
<script>
$('body').scrollTop($(document).height());
$(document).ready(function() {  
  $.ajaxSetup({ cache: true });
  $.getScript('//connect.facebook.net/en_US/all.js', function(){
    window.fbAsyncInit = fbInit;
  });
  $('.offer-btn').click(function(){
    if (typeof Storage != 'undefined') {
      localStorage.pageType = 'offer';
      initPage();
    }
  });
  $('.redeem-btn').click(function(){
    if (typeof Storage != 'undefined') {
      localStorage.pageType = 'redeem';
      initPage();
    }
  });
  $('.suggest-btn').click(function(){
    if (typeof Storage != 'undefined') {
      localStorage.pageType = 'suggest';
      initPage();
    }
  });
  setWrapperSize();

  $('#suggest-form input[name="name"]').bind('keyup', adjustSuggest);
  $('#suggest-form input[name="reason"]').bind('keyup', adjustSuggest);

  if (getBrowserName() == 'Safari') {
    $('#footer').css('position', 'static');
  } else {
    $('#footer').css('position', 'fixed');
  }

  $('.take-picture').change(function(e) {
    var files = e.target.files;
    var file;
    if (files && files.length > 0) {
      file = files[0];
      try {
        var URL = window.webkitURL || window.URL;
        var imgUrl = URL.createObjectURL(file);
        $('.show-picture').load(function(e){
          URL.revokeObjectURL(this.src);
        });
        $('.show-picture').attr('src', imgUrl);
      } catch (e) {
        try {
          var fileReader = new FileReader();
          fileReader.onload = function (e) {
            $('.show-picture').src = e.target.result;
          }
          fileReader.readAsDataUrl(file);
        } catch (e) {
          alert('Unsupported browser');
        }
      }
    }
    adjustSuggest();
  });

  function updateOrientation() {
    window.scrollTo(0, 1);
  }
  window.addEventListener('orientationchange', updateOrientation);

});
</script>

</body>
</html>
